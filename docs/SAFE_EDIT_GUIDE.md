# å®‰å…¨ä¿®æ”¹ä»£ç æŒ‡å—

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨å¢å¼ºçš„è„šæœ¬å·¥å…·æ¥å®‰å…¨åœ°ä¿®æ”¹ä»£ç ï¼Œé¿å…å‡ºé”™å¹¶å®ç°æœ‰æ•ˆå›æ»šã€‚

## ğŸ›¡ï¸ å¿«é€Ÿå¼€å§‹

### æ¨èå·¥ä½œæµç¨‹

**ä¿®æ”¹ä»£ç å‰**ï¼ˆæœ€é‡è¦ï¼ï¼‰:
```bash
# ä½¿ç”¨å®‰å…¨ä¿®æ”¹æ¨¡å¼ï¼ˆä¸€é”®å®Œæˆæ‰€æœ‰ä¿æŠ¤æªæ–½ï¼‰
npm run safe-edit

# æˆ–è€…ä½¿ç”¨å®Œæ•´ä¿æŠ¤æ¨¡å¼
./scripts/safe-edit.sh --stash --tag
```

**ä¿®æ”¹ä»£ç å**:
```bash
# è¿è¡Œé¢„æäº¤æ£€æŸ¥
npm run pre-commit

# å¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œæäº¤ä»£ç 
git add .
git commit -m "feat: your changes"
```

**å¦‚æœå‡ºé”™éœ€è¦å›æ»š**:
```bash
# æ–¹æ³•1: æ¢å¤ Git stashï¼ˆæœ€å¿«ï¼‰
git stash pop

# æ–¹æ³•2: ä½¿ç”¨å›æ»šè„šæœ¬
npm run rollback:code 1.2.12

# æ–¹æ³•3: æ¢å¤å¤‡ä»½æ–‡ä»¶
cp backup/1.2.13_20250125_120000/src/path/file.ts src/path/file.ts
```

## ğŸ“‹ è¯¦ç»†åŠŸèƒ½è¯´æ˜

### 1. å®‰å…¨ä¿®æ”¹æ¨¡å¼ (`safe-edit.sh`)

**åŠŸèƒ½**: åœ¨ä¿®æ”¹ä»£ç å‰åˆ›å»ºå¤šå±‚ä¿æŠ¤

**ä½¿ç”¨æ–¹æ³•**:
```bash
# å®Œæ•´ä¿æŠ¤æ¨¡å¼ï¼ˆæ¨èï¼‰
npm run safe-edit

# æˆ–è€…
./scripts/safe-edit.sh --stash --tag
```

**ä¿æŠ¤æªæ–½**:
- âœ… åˆ›å»ºå¤‡ä»½åˆ†æ”¯
- âœ… åˆ›å»ºæ–‡ä»¶å¤‡ä»½
- âœ… åˆ›å»º Git stashï¼ˆå¯é€‰ï¼‰
- âœ… åˆ›å»º Git æ ‡ç­¾å¿«ç…§ï¼ˆå¯é€‰ï¼‰
- âœ… è¿è¡Œé¢„æäº¤æ£€æŸ¥

**é€‰é¡¹è¯´æ˜**:
- `--no-branch` - ä¸åˆ›å»ºå¤‡ä»½åˆ†æ”¯
- `--no-backup` - ä¸åˆ›å»ºæ–‡ä»¶å¤‡ä»½
- `--stash` - åˆ›å»º Git stash
- `--tag` - åˆ›å»º Git æ ‡ç­¾å¿«ç…§
- `--skip-checks` - è·³è¿‡é¢„æäº¤æ£€æŸ¥

### 2. æ–‡ä»¶å¤‡ä»½ (`backup-before-edit.sh`)

**åŠŸèƒ½**: è‡ªåŠ¨å¤‡ä»½å°†è¢«ä¿®æ”¹çš„æ–‡ä»¶

**ä½¿ç”¨æ–¹æ³•**:
```bash
# å¤‡ä»½æ‰€æœ‰æœªæäº¤çš„å˜æ›´
npm run backup

# æˆ–è€…å¤‡ä»½æŒ‡å®šæ–‡ä»¶
./scripts/backup-before-edit.sh src/services/authService.ts
```

**å¤‡ä»½ä½ç½®**: `backup/{ç‰ˆæœ¬}_{æ—¶é—´æˆ³}/`

**æ¢å¤æ–‡ä»¶**:
```bash
cp backup/1.2.13_20250125_120000/src/path/file.ts src/path/file.ts
```

### 3. é¢„æäº¤æ£€æŸ¥ (`pre-commit-check.sh`)

**åŠŸèƒ½**: åœ¨æäº¤å‰è‡ªåŠ¨æ£€æŸ¥ä»£ç è´¨é‡

**ä½¿ç”¨æ–¹æ³•**:
```bash
npm run pre-commit
```

**æ£€æŸ¥é¡¹**:
- âœ… TypeScript ç±»å‹æ£€æŸ¥
- âœ… è¿è¡Œæµ‹è¯•
- âœ… æ£€æŸ¥æœªè·Ÿè¸ªçš„æ–‡ä»¶
- âœ… æ£€æŸ¥æœªæäº¤çš„å˜æ›´
- âœ… æ£€æŸ¥æ„å»ºäº§ç‰©

### 4. ç‰ˆæœ¬å›æ»š (`rollback.js`)

**åŠŸèƒ½**: å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬

**ä½¿ç”¨æ–¹æ³•**:
```bash
# åˆ—å‡ºæ‰€æœ‰ç‰ˆæœ¬
npm run version:list

# å›æ»šç‰ˆæœ¬å·ï¼ˆä»…æ›´æ–°ç‰ˆæœ¬æ–‡ä»¶ï¼‰
npm run rollback 1.2.12

# å›æ»šä»£ç ï¼ˆåˆ‡æ¢åˆ°æŒ‡å®šç‰ˆæœ¬æ ‡ç­¾ï¼‰
npm run rollback:code 1.2.12

# å®Œæ•´å›æ»šï¼ˆç‰ˆæœ¬å· + ä»£ç ï¼‰
npm run rollback:full 1.2.12
```

## ğŸ”„ å›æ»šç­–ç•¥

### åœºæ™¯1: ä¿®æ”¹åç«‹å³å‘ç°é”™è¯¯

**æœ€å¿«å›æ»šæ–¹æ³•**:
```bash
# å¦‚æœä½¿ç”¨äº† safe-edit.sh --stash
git stash pop

# æˆ–è€…ä¸¢å¼ƒæ‰€æœ‰ä¿®æ”¹
git checkout -- .
```

### åœºæ™¯2: æäº¤åå‘ç°é”™è¯¯

**å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬**:
```bash
# æŸ¥çœ‹ç‰ˆæœ¬åˆ—è¡¨
npm run version:list

# å›æ»šä»£ç åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
npm run rollback:code 1.2.12

# æˆ–è€…ä½¿ç”¨ Git
git checkout v1.2.12
```

### åœºæ™¯3: éœ€è¦æ¢å¤ç‰¹å®šæ–‡ä»¶

**ä»å¤‡ä»½æ¢å¤**:
```bash
# æŸ¥çœ‹å¤‡ä»½ç›®å½•
ls -la backup/

# æ¢å¤æ–‡ä»¶
cp backup/1.2.13_20250125_120000/src/path/file.ts src/path/file.ts
```

### åœºæ™¯4: éœ€è¦å®Œå…¨å›æ»š

**å®Œæ•´å›æ»š**:
```bash
# å®Œæ•´å›æ»šï¼ˆç‰ˆæœ¬å· + ä»£ç ï¼‰
npm run rollback:full 1.2.12

# æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œ
npm run rollback 1.2.12
npm run rollback:code 1.2.12
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä¿®æ”¹å‰å¿…åš

- âœ… è¿è¡Œ `npm run safe-edit` åˆ›å»ºä¿æŠ¤
- âœ… ç¡®è®¤å½“å‰åˆ†æ”¯æ­£ç¡®
- âœ… ç¡®è®¤æ²¡æœ‰æœªæäº¤çš„é‡è¦å˜æ›´

### 2. ä¿®æ”¹ä¸­æ³¨æ„

- âœ… é¢‘ç¹ä¿å­˜æ–‡ä»¶ (`Cmd+S` / `Ctrl+S`)
- âœ… ä½¿ç”¨ `git diff` æŸ¥çœ‹å˜æ›´
- âœ… å°æ­¥æäº¤ï¼Œä¸è¦ä¸€æ¬¡æ€§ä¿®æ”¹å¤ªå¤š

### 3. ä¿®æ”¹åæ£€æŸ¥

- âœ… è¿è¡Œ `npm run pre-commit` æ£€æŸ¥
- âœ… è¿è¡Œ `npm run build` ç¡®è®¤æ„å»ºæˆåŠŸ
- âœ… è¿è¡Œ `npm run test` ç¡®è®¤æµ‹è¯•é€šè¿‡

### 4. æäº¤å‰ç¡®è®¤

- âœ… æ£€æŸ¥ `git status` ç¡®è®¤æ–‡ä»¶æ­£ç¡®
- âœ… æ£€æŸ¥ `git diff` ç¡®è®¤å˜æ›´æ­£ç¡®
- âœ… ç¡®è®¤ç‰ˆæœ¬å·å·²æ›´æ–°ï¼ˆå¦‚éœ€è¦ï¼‰

## ğŸš¨ å¸¸è§é—®é¢˜

### Q: ä¿®æ”¹åä»£ç æ— æ³•è¿è¡Œæ€ä¹ˆåŠï¼Ÿ

**A**: ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å¿«é€Ÿå›æ»šï¼š
```bash
# æ–¹æ³•1: æ¢å¤ stashï¼ˆæœ€å¿«ï¼‰
git stash pop

# æ–¹æ³•2: æ¢å¤å¤‡ä»½æ–‡ä»¶
npm run backup  # å…ˆå¤‡ä»½å½“å‰çŠ¶æ€
# ç„¶åä»ä¹‹å‰çš„å¤‡ä»½æ¢å¤

# æ–¹æ³•3: å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
npm run rollback:code 1.2.12
```

### Q: å¦‚ä½•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„ç‰ˆæœ¬ï¼Ÿ

**A**: 
```bash
npm run version:list
```

### Q: å¦‚ä½•æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ï¼Ÿ

**A**:
```bash
# æŸ¥çœ‹å¤‡ä»½ç›®å½•
ls -la backup/

# æŸ¥çœ‹å¤‡ä»½ä¿¡æ¯
cat backup/1.2.13_20250125_120000/backup-info.json
```

### Q: å¦‚ä½•æ¢å¤ Git stashï¼Ÿ

**A**:
```bash
# æŸ¥çœ‹æ‰€æœ‰ stash
git stash list

# æ¢å¤æœ€æ–°çš„ stash
git stash pop

# æ¢å¤æŒ‡å®šçš„ stash
git stash apply stash@{0}
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è„šæœ¬å·¥å…·è¯´æ˜](../scripts/README.md)
- [ç‰ˆæœ¬ç®¡ç†æŒ‡å—](./VERSION_MANAGEMENT.md)ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- [Git å·¥ä½œæµç¨‹](./GIT_WORKFLOW.md)ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

## ğŸ”— å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# å®‰å…¨ä¿®æ”¹
npm run safe-edit

# å¤‡ä»½æ–‡ä»¶
npm run backup

# é¢„æäº¤æ£€æŸ¥
npm run pre-commit

# ç‰ˆæœ¬ç®¡ç†
npm run version:list
npm run version:info
npm run version:patch
npm run version:minor
npm run version:major

# å›æ»š
npm run rollback <version>        # å›æ»šç‰ˆæœ¬å·
npm run rollback:code <version>  # å›æ»šä»£ç 
npm run rollback:full <version>  # å®Œæ•´å›æ»š
```


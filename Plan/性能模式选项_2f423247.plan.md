---
name: 性能模式选项
overview: 在 YUIChat 的项目设置页面的对话设置 Tab 中，在 AI 头像和欢迎语之间添加性能模式选择功能。使用卡片式 UI，提供"快速模式"(gpt-4o-mini) 和"精准模式"(gpt-4o) 两个选项。
todos:
  - id: db-migration
    content: 数据库迁移：在 chat_config 中添加 performance_mode 字段默认值
    status: completed
  - id: i18n-text
    content: i18n.ts 添加性能模式相关的中/英/日翻译文案
    status: completed
  - id: frontend-ui
    content: SettingsPage.tsx 添加性能模式卡片 UI 组件
    status: completed
    dependencies:
      - i18n-text
  - id: backend-workflow
    content: workflow.py 修改 chat_node 和 chat_node_stream 支持动态模型选择
    status: completed
  - id: backend-api
    content: app.py 修改聊天 API 传递 performance_mode 参数
    status: completed
    dependencies:
      - backend-workflow
  - id: version-update
    content: 更新 VERSION 和 CHANGELOG.md
    status: completed
---

# 性能模式选项功能实现计划

## 需求分析

在 YUIChat 对话设置页面中添加性能模式选择功能，参考 ChatMax 的卡片式 UI 设计：
- **快速模式**：使用 `gpt-4o-mini`，响应时间约 1 秒内，适合实时响应场景
- **精准模式**：使用 `gpt-4o`（当前默认），响应时间约 10 秒，适合需要深度思考的场景

## 技术方案

### 1. 数据库修改

在 `knowledge_bases.chat_config` JSONB 字段中添加 `performance_mode` 属性：

```json
{
  "performance_mode": "fast" | "accurate",  // 新增字段
  "avatar_url": "...",
  "welcome_message": {...},
  "recommended_questions": {...}
}
```

### 2. 前端修改

**主要文件**：[`src/pages/SettingsPage.tsx`](src/pages/SettingsPage.tsx)

在 AI 头像上传区域（第 627-683 行）和欢迎语区域（第 685-733 行）之间添加性能模式选择卡片组件。

**UI 设计**：
- 使用两个卡片并排展示（类似 ChatMax 的设计）
- 快速模式卡片：显示图标、标题、描述（响应时间1秒内，适合实时响应场景）
- 精准模式卡片：显示图标、标题、描述（响应时间较长，适合深度思考场景）+ Beta 标签
- 选中状态使用 primary 颜色边框高亮

**国际化**：[`src/i18n.ts`](src/i18n.ts) 添加中/英/日三语言翻译

### 3. 后端修改

**主要文件**：
- [`backend_py/workflow.py`](backend_py/workflow.py)：第 748 行和第 1015 行左右，修改 `ChatOpenAI` 模型初始化逻辑，根据 `performance_mode` 动态选择模型
- [`backend_py/app.py`](backend_py/app.py)：在 `/api/chat` 和 `/api/chat/stream` 端点中获取并传递 `performance_mode` 参数

## 模型映射

| 性能模式 | 模型 | 特点 |
|---------|-----|------|
| fast | gpt-4o-mini | 响应快，成本低 |
| accurate | gpt-4o | 质量高，响应慢 |

## 版本号

当前版本：1.3.17，新功能版本：1.3.18